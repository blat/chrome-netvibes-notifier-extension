<html>
    <head>
        <title>Netvibes Notifier for Google Chrome</title>
        <script type="text/javascript" src="http://code.jquery.com/jquery.min.js"></script>
        <script type="text/javascript" src="application.js"></script>
        <script type="text/javascript">

            function buildForm() {
                var wrapper = $('#wrapper').empty().append($('<h3>').text('Select your dashboard:'));
                var current = getSelectedDashboard();
                $.each(dashboards, function(id, dashboard) {
                    wrapper.append(
                        $('<input>', {type: 'radio', id: 'dashboard-' + id, value: id, name: 'dashboard', checked: (current != false && id == current.pageId ? 'checked' : '')})
                    ).append(
                        $('<label>', {for: 'dashboard-' + id}).text(dashboard.title)
                    );
                });
                wrapper.append(
                    $('<button>', {id: 'save-button'}).text('Save').click(saveForm)
                );
            }

            function saveForm() {
                var button = $('#save-button')
                    .attr({disabled: 'disabled'}).text('In progress...');
                localStorage['dashboard'] = $('input[type=radio][name=dashboard]:checked')[0].value;
                button.attr({disabled: ''}).text('Saved!');
                refresh();
                return false;
            }

            function signIn() {
                $('#wrapper').empty().append($('<p>').html('<strong>Error:</strong> You have to <a href="' + HOME_URL + '/signin">sign-in</a> before.'));
            }

            function init() {
                getDashboards(buildForm, signIn);
            }

            $(function() {
                init();
            });
        </script>
        <style>
            body {
                font-family: arial, sans-serif;
                font-size: 12px;
                background: #555;
                padding: 0;
                margin: 0;
                color: #fff;
            }
            img {
                float: left;
                padding: 8px;
                width: 32px;
            }
            h1 {
                background: #333;
                margin: 0;
                padding: 8px;
            }
            h3 {
                padding: 8px 0;
                margin: 8px;
            }
            p {
                margin-left: 8px;
            }
            a {
                color: #fff;
            }
            input {
                display: block;
                margin-left: 8px;
                clear: both;
                float: left;
            }
            label {
                display: block;
                padding-top: 2px;
            }
            button {
                display: block;
                margin: 16px 8px;
            }
        </style>
    </head>
    <body>
        <img src="icon.png" />
        <h1>Netvibes Notifier</h1>
        <div id="wrapper">Loading...</div>
    </body>
</html>
